# Loon全局配置 by Tartarus
# 作者GitHub： https://github.com/Tartarus2014
# 脚本库GitHub： https://github.com/Tartarus2014/Loon-Script
# Loon官方文档：https://nsloon.app/docs/intro
# Loon第三方插件中心：https://hub.kelee.one
# Loon第三方知识库：https://t.me/ibilibili/581
# Loon规则GitHub：https://github.com/blackmatrix7/ios_rule_script/tree/master/rule/Loon

# 导入配置。
# 导入完成后点 https://www.nsloon.com/openloon/flowmodel=filter 切换至自动分流模式。
# 再点 https://www.nsloon.com/openloon/proxymode=tun 切换代理模式至 TUN Only 模式 [此操作点击跳转至Loon后即为切换成功]。
# 打开［MitM］［脚本］［复写］三个功能的开关。
# 打开［MitM］里的［MitM over HTTP/2］和［QUIC回退保护］开关。
# 保证Safari是默认浏览器的情况下，安装并信任证书。
# 点击Loon底部导航栏的［配置］→ 右上角的［⋯］，打开［始终开启］的开关。
# 添加你的机场订阅。
# 打开Loon的开关后并点击 https://www.nsloon.com/openloon/update?sub=all 一键更新所有外部资源。

[General]
# IPv6 支持
ip-mode = dual
ipv6-vif = auto
# UDP相关
disable-stun = true
udp-fallback-mode = REJECT
# SNI辅助规则匹配
sni-sniffing = true
# 策略组切换时关闭连接
disconnect-on-policy-change = true
# 域名拦截行为
domain-reject-mode = DNS
dns-reject-mode = LoopbackIP
# > 跳过代理
# 跳过某个域名或者 IP 段，这些目标主机将不会由 Loon Proxy 处理。
skip-proxy = 192.168.0.0/16,10.0.0.0/8,172.16.0.0/12,localhost,*.local,e.crashlynatics.com
# > Always Real IP Hosts
# DNS 数据包将被转发到上游 DNS 服务器。
real-ip = *.apple.com,*apple.com
# 绕过路由
bypass-tun = 10.0.0.0/8,100.64.0.0/10,127.0.0.0/8,169.254.0.0/16,172.16.0.0/12,192.0.0.0/24,192.0.2.0/24,192.88.99.0/24,192.168.0.0/16,198.51.100.0/24,203.0.113.0/24,224.0.0.0/4,255.255.255.255/32
# DNS 服务器
dns-server = 223.5.5.5,180.184.1.1
# doh-server = https://223.5.5.5/dns-query,https://8.8.8.8/dns-query
# Hijack DNS
# 默认情况下，Loon 只返回发送到 Loon DNS 地址的 DNS 查询的假 IP 地址(198.18.0.2)。
# 有些设备或软件总是使用硬编码的 DNS 服务器。 (例如 Google Speakers 总是使用 8.8.8.8)。 您可以使用此选项劫持查询，以获得一个假地址。
hijack-dns = 8.8.8.8:53,8.8.4.4:53
# Wi-Fi 访问
allow-wifi-access = false
wifi-access-http-port = 1234
wifi-access-socks5-port = 1235
mitm-on-wifi-access = false
# 代理测速 URL
internet-test-url = http://connectivitycheck.platform.hicloud.com/generate_204
proxy-test-url = http://detectportal.firefox.com/success.txt
# 测速超时 (s)
test-timeout = 5
# 网络接口
interface-mode = auto
# ssid-trigger参数，用于指定SSID下流量模式切换，（default表示默认，cellular表示蜂窝，目前支持三种值：rule，direct，proxy） 
# ssid-trigger = "default":rule, "cellular":rule,"ASUS_5G":direct
# 解析器
resource-parser = https://raw.githubusercontent.com/sub-store-org/Sub-Store/release/sub-store-parser.loon.min.js

[Proxy]

[Remote Proxy]

[Proxy Group]
FINAL = select, DIRECT, 节点选择, img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Final.png
节点选择 = select, 香港节点, 狮城节点, 美国节点, 台湾节点, 韩国节点, img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Proxy.png
苹果服务 = select, DIRECT, 节点选择, 香港节点, 狮城节点, 美国节点, 台湾节点, 韩国节点, img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Apple.png
奈飞视频 = select, 节点选择, 香港节点, 狮城节点, 美国节点, 台湾节点, 韩国节点, img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Netflix.png
油管视频 = select, 节点选择, 香港节点, 狮城节点, 美国节点, 台湾节点, 韩国节点, img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/YouTube.png
巴哈姆特 = select, 节点选择, 香港节点, 狮城节点, 美国节点, 台湾节点, 韩国节点, img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Bahamut.png
电报消息 = select, 节点选择, 香港节点, 狮城节点, 美国节点, 台湾节点, 韩国节点, img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram.png
港台番剧 = select, DIRECT, 台湾节点, 香港节点, img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/StreamingSE.png
香港节点 = select, 香港, img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png
台湾节点 = select, 台湾, img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Taiwan.png
狮城节点 = select, 新加坡, img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png
韩国节点 = select, 韩国, img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Korea.png
日本节点 = select, 日本, img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png
美国节点 = select, 美国, img-url = https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png

[Remote Filter]
香港 = NameRegex, FilterKey = "^(?=.*((?i)🇭🇰|香港|(\b(HK|HKG|Hong)(\d+)?\b)))(?!.*((?i)回国|校园|游戏|🎮|(\b(GAME)\b))).*$"
台湾 = NameRegex, FilterKey = "^(?=.*((?i)🇹🇼|台湾|(\b(TW|TWN|Tai|Taiwan)(\d+)?\b)))(?!.*((?i)回国|校园|游戏|🎮|(\b(GAME)\b))).*$"
日本 = NameRegex, FilterKey = "^(?=.*((?i)🇯🇵|日本|川日|东京|大阪|泉日|埼玉|(\b(JP|JPN|Japan)(\d+)?\b)))(?!.*((?i)回国|校园|游戏|🎮|(\b(GAME)\b))).*$"
韩国 = NameRegex, FilterKey = "^(?=.*((?i)🇰🇷|韩国|韓|首尔|(\b(KR|KOR|Korea)(\d+)?\b)))(?!.*((?i)回国|校园|游戏|🎮|(\b(GAME)\b))).*$"
新加坡 = NameRegex, FilterKey = "^(?=.*((?i)🇸🇬|新加坡|狮|(\b(SG|SGP|Singapore)(\d+)?\b)))(?!.*((?i)回国|校园|游戏|🎮|(\b(GAME)\b))).*$"
美国 = NameRegex, FilterKey = "^(?=.*((?i)🇺🇸|美国|波特兰|达拉斯|俄勒冈|凤凰城|费利蒙|硅谷|拉斯维加斯|洛杉矶|圣何塞|圣克拉拉|西雅图|芝加哥|(\b(US|USA|United States)(\d+)?\b)))(?!.*((?i)回国|校园|游戏|🎮|(\b(GAME)\b))).*$"

[Rule]
FINAL,FINAL

[Remote Rule]
https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/LocalAreaNetwork.list, policy=DIRECT, tag=局域网, enabled=true
https://raw.githubusercontent.com/Tartarus2014/For-own-use/refs/heads/master/Loon/Rule/Advertising.lsr, policy=REJECT, tag=去广告,enabled=false
https://raw.githubusercontent.com/Tartarus2014/For-own-use/refs/heads/master/Loon/Rule/TestFlight.lsr, policy=节点选择, tag=TestFlight, enabled=true
https://raw.githubusercontent.com/Tartarus2014/For-own-use/refs/heads/master/Loon/Rule/Github.lsr, policy=节点选择, tag=Github, enabled=true
https://raw.githubusercontent.com/Tartarus2014/For-own-use/refs/heads/master/Loon/Rule/Apple.lsr, policy=苹果服务, tag=苹果服务, enabled=true
https://raw.githubusercontent.com/Tartarus2014/For-own-use/refs/heads/master/Loon/Rule/YouTube.lsr, policy=油管视频, tag=油管视频, enabled=true
https://raw.githubusercontent.com/Tartarus2014/For-own-use/refs/heads/master/Loon/Rule/Netflix.lsr, policy=奈飞视频, tag=奈飞视频, enabled=true
https://raw.githubusercontent.com/Tartarus2014/For-own-use/refs/heads/master/Loon/Rule/Bahamut.lsr, policy=巴哈姆特, tag=巴哈姆特, enabled=trueue
https://raw.githubusercontent.com/Tartarus2014/For-own-use/refs/heads/master/Loon/Rule/Bilibili.lsr, policy=港台番剧, tag=国内媒体, enabled=true
https://raw.githubusercontent.com/Tartarus2014/For-own-use/refs/heads/master/Loon/Rule/Telegram.lsr, policy=电报消息, tag=电报消息, enabled=true
https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ProxyGFWlist.list, policy=节点选择, tag=全球规则, enabled=true
https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ProxyLite.list, policy=节点选择, tag=全球规则, enabled=true
https://raw.githubusercontent.com/Tartarus2014/For-own-use/refs/heads/master/Loon/Rule/Direct.lsr, policy=DIRECT, tag=全球直连, enabled=true
https://raw.githubusercontent.com/Tartarus2014/For-own-use/refs/heads/master/Ruleset/GEOIP.list, policy=DIRECT, tag=GEOIP_CN, enabled=true

[Host]

[Rewrite]

[Script]

[Plugin]
https://kelee.one/Tool/Loon/Lpx/LoonGallery.lpx, enabled = true
https://raw.githubusercontent.com/Peng-YM/Sub-Store/master/config/Loon.plugin, enabled=false
https://raw.githubusercontent.com/Script-Hub-Org/Script-Hub/main/modules/script-hub.loon.plugin, enabled=false
https://raw.githubusercontent.com/Tartarus2014/Loon-Script/master/Plugin/Block/Advertising.lpx, enabled=true
https://kelee.one/Tool/Loon/Lpx/LoonGallery.lpx, enabled=true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rewrite/Loon/Redirect/Redirect.plugin, enabled=true
https://raw.githubusercontent.com/chavyleung/scripts/master/box/rewrite/boxjs.rewrite.loon.plugin, enabled=true

[Mitm]
hostname = 
ca-p12 = 
ca-passphrase = 
skip-server-cert-verify = true
